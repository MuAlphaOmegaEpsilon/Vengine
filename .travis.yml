language: cpp
dist: xenial
git:
  depth: false

matrix:
  include:
  
  - os: linux
    env: COVERAGE=true
    addons:
      apt:
        packages: libvulkan-dev mesa-vulkan-drivers vulkan-utils
      sonarcloud:
        organization: "mualphaomegaepsilon-github"
    before_script:
    - sudo rm /usr/bin/gcov && sudo ln -s /usr/bin/gcov-5 /usr/bin/gcov
    after_script:
    - sonar-scanner
        
  - os: linux
    compiler: clang
    addons:
      apt:
        packages: libvulkan-dev mesa-vulkan-drivers vulkan-utils
    
  - os: osx
    osx_image: xcode11
    addons:
      homebrew:
        packages:
        - molten-vk
    install:
    - VULKAN_VERSION=1.1.108.0 && export VULKAN_VERSION \
      LUNARG_URL=https://sdk.lunarg.com/sdk/download/"${VULKAN_VERSION}" && export LUNARG_URL \
      VULKAN_SDK_TAR="vulkansdk-macos-${VULKAN_VERSION}.tar.gz" && VULKAN_SDK_TAR \
      wget "${LUNARG_URL}/mac/${VULKAN_SDK_TAR}" \
      tar xf "${VULKAN_SDK_TAR}" \
      cd vulkansdk-macos-"${VULKAN_VERSION}" && ./install_vulkan.py

script:
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then ./scripts/shellcheck.sh; fi
- ./tests/setup.sh
- ./tests/build.sh
- ./tests/run.sh
- cd tests/build/ && ./test_initializeVulkan && echo $?
