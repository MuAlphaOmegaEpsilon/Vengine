language: cpp
dist: xenial
git:
  depth: false

matrix:
  include:
  
  - os: linux
    env: COVERAGE=true
    addons:
      apt:
        packages: libvulkan-dev mesa-vulkan-drivers vulkan-utils
      sonarcloud:
        organization: "mualphaomegaepsilon-github"
    before_script:
    - sudo rm /usr/bin/gcov && sudo ln -s /usr/bin/gcov-5 /usr/bin/gcov
    after_script:
    - sonar-scanner
        
  - os: linux
    compiler: clang
    addons:
      apt:
        packages: libvulkan-dev mesa-vulkan-drivers vulkan-utils
    
  - os: osx
    osx_image: xcode11
    install:
    - wget --no-cookies -O vulkansdk.tar.gz https://sdk.lunarg.com/sdk/download/1.1.108.0/mac/vulkansdk-macos-1.1.108.0.tar.gz?Human=true
    - tar -xzf vulkansdk.tar.gz
    - (cd vulkansdk-macos-1.1.108.0/ && ./install_vulkan.py)

script:
- mkdir -p tests/build && cd tests/build
- cmake .. $CMAKE_ARGS
- ${CMAKE_BUILD_WRAPPER} cmake --build .
# Only test runtime under Linux, since osx is missing Metal
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then ctest -j2; fi
